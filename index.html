<script>
        lucide.createIcons();
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyXgxqgWrmIurQgIUENqH2TcSZa_gwZm53jY3caH9Y6bdf65v9UO_q5mrr-7939MBbi/exec";

        // ... (ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜, í† ìŠ¤íŠ¸ ì•Œë¦¼, ë³µì‚¬ í•¨ìˆ˜ ë“±ì€ ê·¸ëŒ€ë¡œ ìœ ì§€) ...

        // [ìˆ˜ì •ë¨] API í˜¸ì¶œ í•¨ìˆ˜ê°€ ì´ì œ ê°ì²´({ type, input })ë¥¼ ë°›ìŠµë‹ˆë‹¤.
        async function callGeminiAPI(dataObj) {
            try {
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(dataObj) // ê°ì²´ ì „ì²´ë¥¼ ì „ì†¡
                });
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                return data.result;
            } catch (error) {
                console.error("Error calling proxy:", error);
                throw error;
            }
        }

        // [ìˆ˜ì •ë¨] í”„ë¡¬í”„íŠ¸ ë‚´ìš© ì‚­ì œ -> typeê³¼ inputë§Œ ì „ì†¡
        async function analyzePersona() {
            const input = document.getElementById('personaInput').value.trim();
            const btn = document.getElementById('personaBtn');
            const resultBox = document.getElementById('personaResult');
            const titleEl = document.getElementById('personaTitle');
            const descEl = document.getElementById('personaDesc');

            if (!input) {
                alert("ì—°ì•  ìŠ¤íƒ€ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="loader"></span> ë¶„ì„ ì¤‘...';
            resultBox.classList.add('hidden');

            try {
                // ì—¬ê¸°ì„œ êµ¬êµ¬ì ˆì ˆí•œ í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ë‚¼ í•„ìš”ê°€ ì—†ì–´ì¡ŒìŠµë‹ˆë‹¤!
                const text = await callGeminiAPI({ 
                    type: "persona", 
                    input: input 
                });

                const lines = text.split('\n').filter(line => line.trim() !== '');
                let title = lines[0] || "ë§¤ë ¥ì ì¸ ì£¼ì¸ê³µ";
                let desc = lines.slice(1).join(' ') || "ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ëŠ” ë¬´ëŒ€ ìœ„ì—ì„œ ê°€ì¥ ë¹›ë‚  ê²ƒì…ë‹ˆë‹¤.";
                title = title.replace(/\[|\]/g, '').replace(/\*/g, ''); 
                desc = desc.replace(/\[|\]/g, '').replace(/\*/g, '');
                titleEl.textContent = title;
                descEl.textContent = desc;
                resultBox.classList.remove('hidden');
            } catch (error) {
                console.error(error);
                showToast("ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>âœ¨ ë‹¤ì‹œ ë¶„ì„í•˜ê¸°</span>';
            }
        }

        // [ìˆ˜ì •ë¨] í”„ë¡¬í”„íŠ¸ ë‚´ìš© ì‚­ì œ -> typeë§Œ ì „ì†¡
        async function generateQuestion() {
            const btn = document.getElementById('questionBtn');
            const box = document.getElementById('questionBox');
            btn.disabled = true;
            btn.innerHTML = '<span class="loader border-stone-400 border-t-stone-800"></span> ìƒì„± ì¤‘...';
            
            try {
                // ì—¬ê¸°ë„ typeë§Œ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.
                const text = await callGeminiAPI({ 
                    type: "question" 
                });
                
                box.innerHTML = `<p class="text-stone-800 font-medium text-sm leading-relaxed">"${text.trim()}"</p>`;
            } catch (error) {
                console.error(error);
                box.innerHTML = `<p class="text-red-500 text-xs font-bold">ì˜¤ë¥˜ ë°œìƒ:<br>${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>ğŸ’¬ ë‹¤ë¥¸ ì§ˆë¬¸ ë³´ê¸°</span>';
            }
        }
    </script>
